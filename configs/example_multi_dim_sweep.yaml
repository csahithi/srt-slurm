# Example multi-dimensional parameter sweep
# Sweeps over multiple SGLang flags and benchmark parameters

name: "sglang-tuning-sweep"

slurm:
  account: "your-account"
  partition: "gpu"
  time_limit: "04:00:00"

resources:
  prefill_nodes: 1
  decode_nodes: 12
  prefill_workers: 1
  decode_workers: 1
  gpus_per_node: 4

model:
  path: "/models/deepseek-r1"
  container: "/containers/sglang.sqsh"

backend:
  type: "sglang"

  environment:
    DYN_SKIP_SGLANG_LOG_FORMATTING: "1"
    PYTHONUNBUFFERED: "1"

  sglang_config:
    shared:
      served_model_name: "deepseek-ai/DeepSeek-R1"
      model_path: "/model/"
      kv_cache_dtype: "fp8_e4m3"
      trust_remote_code: true

    prefill:
      disaggregation_mode: "prefill"
      mem_fraction_static: "{mem_fraction}"
      max_total_tokens: "{max_tokens}"
      chunked_prefill_size: "{prefill_size}"
      max_running_requests: "{max_requests}"

    decode:
      disaggregation_mode: "decode"
      mem_fraction_static: "{mem_fraction}"
      max_total_tokens: "{max_tokens}"
      chunked_prefill_size: "{prefill_size}"
      max_running_requests: "{max_requests}"

benchmark:
  type: "sa-bench"
  isl: 1024
  osl: 1024
  concurrencies: "{concurrency}"
  req_rate: "inf"

# Multi-dimensional sweep
sweep:
  type: "grid"
  parameters:
    # SGLang flags
    mem_fraction: [0.82, 0.84, 0.86]
    max_tokens: [131072, 262144]
    prefill_size: [32768, 65536]
    max_requests: [20000, 30000]

    # Benchmark parameters
    concurrency: [1024, 2048, 4096]

  # Total: 3 × 2 × 2 × 2 × 3 = 72 jobs
  # Each combination will be tested
